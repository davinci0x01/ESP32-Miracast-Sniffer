<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>ESP32 Miracast Sniffer · Web Installer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- ESP Web Tools -->
  <script type="module" src="https://unpkg.com/esp-web-tools@9/dist/web/install-button.js"></script>

  <style>
    :root{
      --bg:#020617;
      --card:#0b1220;
      --border:#172554;
      --text:#e5e7eb;
      --muted:#94a3b8;
      --accent:#38bdf8;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      min-height:100vh;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      background:
        radial-gradient(900px 500px at 10% 10%, #0f172a, transparent),
        radial-gradient(700px 350px at 90% 90%, #020617, transparent),
        var(--bg);
      display:flex;
      align-items:center;
      justify-content:center;
      padding:18px;
    }

    .wrap{
      width:100%;
      max-width:980px;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap:16px;
      text-align:center;
    }

    .topbar{
      width:100%;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
      flex-wrap:wrap;
    }

    .pill{
      padding:10px 12px;
      border-radius:12px;
      border:1px solid rgba(23,37,84,.8);
      background: rgba(2,6,23,.35);
      color: var(--text);
      cursor:pointer;
      font-weight:800;
      font-size:13px;
      text-decoration:none;
      display:inline-flex;
      align-items:center;
      gap:8px;
    }
    .pill:hover{border-color:rgba(56,189,248,.6)}

    .brand{
      display:flex;
      flex-direction:column;
      gap:8px;
      align-items:center;
      margin-top:6px;
    }

    .title{
      margin:0;
      font-size:34px;
      color:var(--accent);
      letter-spacing:.2px;
    }
    .sub{
      margin:0;
      color:var(--muted);
      line-height:1.7;
      max-width:820px;
    }

    /* One big round button */
    .round{
      width:170px;
      height:170px;
      border-radius:999px;
      border:1px solid rgba(56,189,248,.45);
      background: radial-gradient(circle at 30% 30%, rgba(56,189,248,.33), rgba(2,6,23,1));
      color:var(--text);
      font-weight:900;
      font-size:16px;
      cursor:pointer;
      box-shadow: 0 24px 90px rgba(0,0,0,.65);
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap:6px;
      transition: transform .12s ease, border-color .12s ease;
    }
    .round:hover{
      transform: translateY(-2px);
      border-color: rgba(56,189,248,.8);
    }
    .round small{
      color:var(--muted);
      font-weight:800;
      font-size:12px;
    }

    .card{
      width:100%;
      max-width:860px;
      background: linear-gradient(180deg, rgba(11,18,32,.95), rgba(2,6,23,.95));
      border:1px solid rgba(23,37,84,.85);
      border-radius:18px;
      padding:16px;
      text-align:right;
    }
    .card h2{
      margin:0 0 10px 0;
      font-size:16px;
    }
    .card p{
      margin:0;
      color:var(--muted);
      line-height:1.75;
      font-size:13px;
    }
    .kv{
      margin-top:12px;
      border-radius:14px;
      border:1px solid rgba(23,37,84,.75);
      background: rgba(2,6,23,.35);
      padding:12px;
    }
    .kv .k{color:#9fb2d0;font-size:12px;margin-bottom:6px}
    .kv .v{color:var(--text);font-weight:900}

    .links{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:10px;
    }

    /* Keep esp-web-install-button from taking layout space weirdly */
    esp-web-install-button{
      display:inline-block;
    }

    /* RTL/LTR helper */
    .ltr{direction:ltr;text-align:left}
    .rtl{direction:rtl;text-align:right}

    @media (max-width:520px){
      .title{font-size:28px}
      .round{width:155px;height:155px}
      .card{text-align:right}
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <a class="pill" href="https://github.com/davinci0x01" target="_blank" rel="noreferrer">
        GitHub: davinci0x01
      </a>

      <button class="pill" id="langBtn" type="button">EN</button>
    </div>

    <div class="brand">
      <h1 class="title" id="tTitle">ESP32 Miracast Sniffer</h1>
      <p class="sub" id="tSub">
        مثبّت بنقرة واحدة. اضغط الزر بالأسفل، اختر منفذ USB/COM، ثم اتبع نافذة التثبيت.
      </p>
    </div>

    <!-- ONE BUTTON ONLY:
         We let esp-web-tools handle everything (connect + install + optional erase/serial inside its UI) -->
    <esp-web-install-button manifest="manifest.json">
      <button class="round" type="button" id="mainBtn">
        تثبيت
        <small id="mainBtnSmall">Connect & Install</small>
      </button>
    </esp-web-install-button>

    <div class="card rtl" id="infoCard">
      <h2 id="tHow">كيف تستخدمها؟</h2>
      <p id="tHowP">
        1) وصّل ESP32 بالكابل.<br>
        2) اضغط زر التثبيت.<br>
        3) اختر المنفذ (COM/USB) من النافذة التي ستظهر.<br>
        4) أكمل التثبيت من واجهة الأداة (هي التي تعرض الخيارات المتاحة مثل Erase أو Serial إذا كانت مدعومة).
      </p>

      <div class="kv">
        <div class="k" id="tBaudK">Serial Baud Rate</div>
        <div class="v ltr">115200</div>
      </div>

      <div class="kv">
        <div class="k" id="tAndroidK">Android Serial App (Mobile)</div>
        <div class="v ltr">
          <a href="https://play.google.com/store/apps/details?id=com.serialcloud.usbterminal" target="_blank" rel="noreferrer" style="color:#93c5fd; font-weight:900; text-decoration:none;">
            Serial USB Terminal (com.serialcloud.usbterminal)
          </a>
        </div>
        <p class="ltr" style="margin-top:8px;color:#94a3b8;font-size:12px;">
          Tips: UTF-8 (Arabic), Line ending: Newline (\n), Baud: 115200
        </p>
      </div>
    </div>
  </div>

  <script>
    const state = { ar: true };

    const el = (id) => document.getElementById(id);

    function setAR(){
      state.ar = true;
      document.documentElement.lang = "ar";
      document.documentElement.dir = "rtl";

      el("langBtn").textContent = "EN";

      el("tTitle").textContent = "ESP32 Miracast Sniffer";
      el("tSub").textContent = "مثبّت بنقرة واحدة. اضغط الزر بالأسفل، اختر منفذ USB/COM، ثم اتبع نافذة التثبيت.";

      el("mainBtn").childNodes[0].textContent = "تثبيت";
      el("mainBtnSmall").textContent = "Connect & Install";

      el("infoCard").classList.remove("ltr");
      el("infoCard").classList.add("rtl");

      el("tHow").textContent = "كيف تستخدمها؟";
      el("tHowP").innerHTML =
        "1) وصّل ESP32 بالكابل.<br>" +
        "2) اضغط زر التثبيت.<br>" +
        "3) اختر المنفذ (COM/USB) من النافذة التي ستظهر.<br>" +
        "4) أكمل التثبيت من واجهة الأداة (هي التي تعرض الخيارات المتاحة مثل Erase أو Serial إذا كانت مدعومة).";

      el("tBaudK").textContent = "إعدادات السيريال (Baud Rate)";
      el("tAndroidK").textContent = "تطبيق السيريال على أندرويد (للموبايل)";
    }

    function setEN(){
      state.ar = false;
      document.documentElement.lang = "en";
      document.documentElement.dir = "ltr";

      el("langBtn").textContent = "AR";

      el("tTitle").textContent = "ESP32 Miracast Sniffer";
      el("tSub").textContent = "One-click installer. Press the button below, select the USB/COM port, then follow the installer window.";

      el("mainBtn").childNodes[0].textContent = "Install";
      el("mainBtnSmall").textContent = "Connect & Install";

      el("infoCard").classList.remove("rtl");
      el("infoCard").classList.add("ltr");

      el("tHow").textContent = "How to use";
      el("tHowP").innerHTML =
        "1) Plug the ESP32 via USB.<br>" +
        "2) Press Install.<br>" +
        "3) Select the USB/COM port in the popup.<br>" +
        "4) Finish inside the installer UI (it may show options like Erase or Serial if supported).";

      el("tBaudK").textContent = "Serial Baud Rate";
      el("tAndroidK").textContent = "Android Serial App (Mobile)";
    }

    el("langBtn").addEventListener("click", () => {
      state.ar ? setEN() : setAR();
    });

    // Default Arabic
    setAR();
  </script>
</body>
</html>
